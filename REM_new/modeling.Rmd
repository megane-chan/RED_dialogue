```{r, message = FALSE}
# Last Updated: 02/12
rm(list = ls())

# Load libraries
library(rstudioapi)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(dplyr)

library(RColorBrewer)
library(dplyr)
library(igraph)
library(readxl)
library(igraph)
library(glmnet)
library(remsonic)
library(skimr)
library(dplyr)
library(relevent)
# Set Path
setwd("~/RProjects/SNA_REM/REM_new/")
```


```{r}
readRDS("data/rem_data.rds") -> data
data %>% filter(!is.na(snd_da) & !is.na(rec_da)) %>% skim()
```


```{r}
dialog_act <- sort(unique(data$dialog_act)) %>% as.factor()


data$sender <- as.factor(data$sender)
data$receiver <- as.factor(data$receiver)
data$snd_gender <- as.factor(data$snd_gender)
data$rec_gender <- as.factor(data$rec_gender)
$snd_da <- as.factor(data$snd_da)
data$rec_da <- as.factor(data$rec_da)


rem_dataset <- createRemDataset(start = 2102, end = 2119, sender = snd_id, target = rec_id, dialogue_act, eventSequence = session)


```

```{r}
rem_model_refined <- update(
  rem_model,
  formula = rec_da ~ snd_da + snd_gender + rec_gender + snd_gender:rec_gender
)


fit_results_refined <- fitrem(rem_model_refined)

summary(fit_results_refined)


```
```{r}
# Load the necessary library
library(TraMineR)

# Assuming your data frame is named 'data_with_gender'
# and it's ordered by time (sequence represents time)

# Create transition features
data_with_gender <- data_with_gender %>%
  group_by(session) %>%
  mutate(
    previous_act = lag(dialogue_act, default=first(dialogue_act)),
    next_act = lead(dialogue_act, default=last(dialogue_act)),
    previous_gender = lag(gender, default=first(gender))
  ) %>%
  ungroup()

# Remove rows with no next_act if they are not useful for your analysis
data_with_gender <- data_with_gender %>%
  filter(!is.na(next_act))

# Create a sequence object
seqdef_data <- seqdef(data_with_gender$dialogue_act)

# Explore sequence patterns
seqiplot(seqdef_data) # Interactive sequence index plot
seqdplot(seqdef_data) # Sequence distribution plot

# For statistical analysis, you might consider sequence analysis metrics
# such as transition rates between states, complexity indices, or others.

# For example, to compute transition rates between dialogue acts
seqtrate <- seqtrate(seqdef_data)

# Print the transition rates
print(seqtrate)

# This is a simple example and does not take into account the gender directly.
# For a more advanced analysis, you could create separate sequence objects
# by gender and compare the transition patterns across genders.

```
```

